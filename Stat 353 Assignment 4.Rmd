---
title: "Stat 353 Assignment 4"
author: "Brody Reid - V00818610"
date: "12/1/2017"
output:
  html_document: default
  pdf_document: default
---
```{r, setup}
library(MASS)
library(leaps)
library(readxl)
setwd("~/Desktop/Stat 353 Data")
```

#### Question 6.15
```{r, echo=FALSE}
vent <- read_excel("~/Desktop/Stat 353 Data/ventilation.xlsx")
venty <- vent$Y
ventx <- vent$X
plot(ventx,venty,type="p",xlab="Oxygen Uptake",ylab="Expired Ventilation",main="Expired ventilation against oxygen uptake")
abline(ventlm)
```
```{r}
ventlm <- lm(venty ~ ventx)
par(mfrow=c(2,2))
plot(ventlm)
```
The scatter plot of the data, along with the plot of residuals vs fitted values, reveals a strong correlation between the variance and the values of $\hat{\mu_i}$. We try a logarithmic transformation.
```{r}
ventylog <- log(venty)
ventloglm <- lm(ventylog ~ ventx)
#par(mfrow=c(2,2))
plot(ventloglm)
```
Observe that there is an outlying data point that has a large studentized residual and a large leverage and in turn a large Cook's distance. We remove this point and fit the model again.
```{r}
ventylog2 <- ventylog[-1]
ventx2 <- ventx[-1]

ventloglm2 <- lm(ventylog2 ~ ventx2)
par(mfrow=c(2,2))
plot(ventloglm2)

summary(ventloglm2)
```
So the transformed model $\ln(y)=2.407+5.762\times10^{-4}x$.









#### Question 7.2
```{r,include=FALSE}
hald <- read_excel("~/Desktop/Stat 353 Data/hald.xlsx")
haldy <- hald$Y
haldx1 <- hald$X1
haldx2 <- hald$X2
haldx3 <- hald$X3
haldx4 <- hald$X4

haldX <- matrix(c(haldx1,haldx2,haldx3,haldx4), ncol=4)
```

```{r}
leaps(haldX, haldy)$which
leaps(haldX, haldy, method="r2")$r2
leaps(haldX, haldy, method="Cp")$Cp
```


Observe that the $R^2$ for $x_1, x_2$ is 0.9787, which is larger than any other two variable models. The $C_p$ statistic for the $x_1, x_2$ model is 2.678 which is close to $p=3$, so again, the model with $x_1, x_2$ seems to fit best.

Backward elimination:
```{r}
summary(lm(haldy~haldx1+haldx2+haldx3+haldx4))$coefficients
```
Since the $p$ value of $x_3$ is the largest, we drop it from the model.

```{r}
summary(lm(haldy~haldx1+haldx2+haldx4))$coefficients
```
Then since the $p$ value of $x_4$ is the largest, we drop it from the model.

```{r}
summary(lm(haldy~haldx1+haldx2))$coefficients
```
Since both $x_1$ and $x_2$ have very small $p$ values, they are both significant to the model. So we arrive at the model that includes $x_1, x_2$.

Forward selection:
```{r}
summary(lm(haldy~haldx1))$coefficients
summary(lm(haldy~haldx2))$coefficients
summary(lm(haldy~haldx3))$coefficients
summary(lm(haldy~haldx4))$coefficients
```
Since $x_4$ has the smallest $p$ value, we built the model around $x_4$.

```{r}
summary(lm(haldy~haldx1+haldx4))$coefficients
summary(lm(haldy~haldx2+haldx4))$coefficients
summary(lm(haldy~haldx3+haldx4))$coefficients
```
Since the $p$ values for tje $x_1, x_4$ model are very small, we conclude that both the variables are significant. We continue:

```{r}
summary(lm(haldy~haldx1+haldx2+haldx4))$coefficients
summary(lm(haldy~haldx1+haldx3+haldx4))$coefficients
```
Since $x_2$ has a smaller $p$ value, we conclude that the final model should be comprised of the variables $x_1, x_2, x_4$.

#### Question 7.3
```{r, include=FALSE}
market <- read_excel("~/Desktop/Stat 353 Data/market.xlsx")
markety1 <- market$Y1
markety2 <- market$Y2
markety3 <- market$Y3
marketx1 <- market$X1
marketx2 <- market$X2
marketx3 <- market$X3
marketx4 <- market$X4

marketX <- matrix(c(marketx1,marketx2,marketx3,marketx4), ncol=4)
```

Determining the best model for $y_1$:
```{r}
leaps(marketX, markety1, method="r2")
leaps(marketX, markety1, method="Cp")
```
We observe $R^2=0.633$ for the model with $x_3, x_4$, and $C_p=5.83$, so we conclude that the best model for $y_1$ is comprised of $x_3$ and $x_4$.

Determining the best model for $y_2$:
```{r}
leaps(marketX, markety2, method="r2")
leaps(marketX, markety2, method="Cp")
```
We observe $R^2=0.992$ for the model with $x_1, x_2, x_3$, and $C_p=3.01$, so we conclude that the best model for $y_2$ is comprised of $x_1$, $x_2$ and $x_3$.

Determining the best model for $y_3$:
```{r}
leaps(marketX, markety3, method="r2")
leaps(marketX, markety3, method="Cp")
```
We observe $R^2=0.666$ for the model with $x_1, x_3, x_4$, and $C_p=3.01$, so we conclude that the best model for $y_3$ is comprised of $x_1$, $x_3$ and $x_4$.

```{r}
summary(lm(markety1~marketx3+marketx4))$coefficients
```
Since $x_4$ has a smaller $p$ value, we conclude that the change in production from the last period ($x_4$) is the most important factor for influencing overhead costs ($y_1$).

```{r}
summary(lm(markety2~marketx1+marketx2+marketx3))$coefficients
```
Since $x_2$ has the smallest $p$ value, we conclude that production quantity ($x_2$) is the most important factor for influencing direct production costs ($y_1$).

#### Question 7.10
```{r}
election <- read_excel("~/Desktop/Stat 353 Data/election.xlsx")

perbush <- election$per_Bush

unemployment <- election$UnEmpR
totalpop <- election$Tot_Pop
permale <- election$per_Male
permale18 <- election$`per_Male>18`
perpop65 <- election$`per_Pop>65`
rural <- election$per_NonMetro
poverty <- election$per_PopPov
households <- election$NuHouse
income50 <- election$`per_Inc>50`
income75 <- election$`per_Inc>75`
income100 <- election$`per_Inc>100`

electionX <- matrix(c(unemployment,totalpop,permale,permale18,perpop65,rural,poverty,households,income50,income75,income100), ncol=11)
```

```{r, results='hide'}
leaps(electionX, perbush, method="r2")
leaps(electionX, perbush, method="Cp")
```
We see that with only four variables we can get $R^2=0.686$ and $C_p=11.5$ which is close to $p=10$. This four variable model is comprised of the proportion of males, the proprtion of males over 18, the proportion of rural population, and the proportion of the population below the poverty rate.


